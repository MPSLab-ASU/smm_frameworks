#! /usr/bin/env python
import getopt
import math
import os
import subprocess
import sys


def run():

	for ratio in range[0, 1, 0.25]
		command = "./configure --dcache-size " + str(dsize) + " --tile-size " + str(tile_size) + " --ratio " + str(ratio)
		subprocess.call(command, shell=True)
		command = "./run-cache; ./clean; ./run-spm"
		subprocess.call(command, shell=True)
		command = "./tabulate --output experiment_" + str(dsize) + "B.xlsx"
		subprocess.call(command, shell=True)
		dsize = dsize * 2

def run_data():
	tile_size = 128
	min_dsize = 2 * 1024
	max_dsize = 64 * 1024
	dsize = min_dsize

	while dsize <=  max_dsize:
		command = "./configure --dcache-size " + str(dsize) + " --tile-size " + str(tile_size) + " --data"
		subprocess.call(command, shell=True)
		command = "./run-cache; ./clean; ./run-spm --data"
		subprocess.call(command, shell=True)
		command = "./tabulate --output experiments_" + str(dsize) + "B.xlsx --data"
		subprocess.call(command, shell=True)
		dsize = dsize * 2	 
	subprocess.call(command, shell=True)


try:
	opts, args = getopt.getopt(sys.argv[1:], "-h", ["data"]) 
except getopt.GetoptError as err:
	print str(err)
	sys.exit(2)
config = 1

for opt, arg in opts:
   	if opt in ("--data"):
		config = 2
if config == 1:
	run()
elif config == 2:
    	run_data()
